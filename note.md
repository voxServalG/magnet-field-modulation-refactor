# 验证记录

## 2026-01-11
- **任务**: 比较 `离散化磁场计算及优化算法Bx` 目录下的 `la_saved.mat` 与 `python_refactor/compare_la.py` 的计算结果。
- **结果**: **匹配 (Match)**。
- **详细数据**:
    - 最大绝对误差: `9.88e-07`
    - 参考值量级: `6.82e+06`
    - 相对误差: 约 `1.45e-13`
- **结论**: Python 重构代码成功复现了 MATLAB 的流函数系数 (la) 计算逻辑。微小差异属于正常的浮点运算精度范围。

## 2026-01-11 补充：物理仿真核心坑点记录

### 1. 任务：验证 `main.py` 正向物理仿真结果
- **现象**: 初始仿真结果显示中心磁场 $B_0$ 接近 0（$2.3 \times 10^{-3} \text{ nT}$），相对误差高达 0^7 \%$。
- **定位**: 发现 `physics.py` 中的电流方向逻辑存在“二次修正”错误。
- **坑点描述**: 
    - **误区**: 认为必须手动判断线圈的顺逆时针（Shoelace 算法）并强制修正电流正负。
    - **真相**: 流函数 $\Phi$ 的等值线提取函数 (`contour`) 返回的点序列已经天然包含了梯度方向信息。
    - **后果**: 手动修正方向导致了“山峰”（正值区）与“盆地”（负值区）的磁场由相互配合变成了相互抵消。
- **修复**: 在 `calculate_field_from_coils` 中移除 `direction_sign` 的干扰，直接信任 `contour` 生成的路径方向。
- **最终结果**: 
    - 中心磁场恢复至 **383.53 nT**。
    - 均匀度误差 **1.27%**，完美对标 MATLAB 原版。

---
**下班总结**: 尊重数学原生的拓扑结构，不要在物理积分层做多余的逻辑干预。